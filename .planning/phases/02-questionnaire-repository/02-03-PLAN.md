---
phase: 02-questionnaire-repository
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [data/questionnaires/physician.json]
autonomous: true
gap_closure: true
requirements: [QUES-01, QUES-02, QUES-03, QUES-04, QUES-05, QUES-06]

must_haves:
  truths:
    - "Physician questionnaire has a show_when condition branching from surgical_practice"
    - "Physician questionnaire has conditional branching on both axes: academic/private practice AND surgical/non-surgical"
    - "All existing tests continue to pass with no regressions"
  artifacts:
    - path: "data/questionnaires/physician.json"
      provides: "Physician questionnaire with surgical/non-surgical conditional branch"
      contains: "show_when.*surgical_practice"
  key_links:
    - from: "data/questionnaires/physician.json"
      to: "surgical_practice question"
      via: "show_when condition on new question"
      pattern: "show_when.*question_id.*surgical_practice"
---

<objective>
Add the missing surgical/non-surgical conditional branching question to the physician questionnaire.

Purpose: QUES-02 requires two branching axes in the physician questionnaire: (1) academic/private practice, and (2) surgical/non-surgical. The academic/private branch exists (supervision_role branches from practice_setting=academic), but no question branches from surgical_practice. This gap closure adds one question that conditionally appears only when surgical_practice is answered "true", completing the required branching pattern.

Output: Updated physician.json with a surgical-specific conditional question
</objective>

<execution_context>
@/Users/medomatic/.claude/get-shit-done/workflows/execute-plan.md
@/Users/medomatic/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-questionnaire-repository/02-VERIFICATION.md
@.planning/phases/02-questionnaire-repository/02-02-SUMMARY.md
@data/questionnaires/physician.json
@src/questionnaires/cans-fields.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add surgical subspecialty conditional question to physician questionnaire</name>
  <files>data/questionnaires/physician.json</files>
  <action>
Add a new question immediately after the existing `surgical_practice` question (after index 8, before `patient_education`) in `data/questionnaires/physician.json`.

The new question must:
1. Have `show_when: { "question_id": "surgical_practice", "equals": "true" }` -- this is the missing surgical/non-surgical branch
2. Use a valid CANS field from the allowlist in `src/questionnaires/cans-fields.ts`
3. Be clinically meaningful for surgical physicians
4. Use the `single_select` answer type (to demonstrate that the surgical branch supports more than just boolean)
5. NOT reference any new taxonomy action IDs -- the surgical_practice question already grants the surgical action IDs. This question refines scope metadata, not action grants.

Recommended question:

```json
{
  "id": "surgical_subspecialty",
  "text": "What best describes your surgical practice?",
  "answer_type": "single_select",
  "required": true,
  "options": [
    {
      "value": "general_surgery",
      "label": "General Surgery",
      "description": "Broad-spectrum surgical procedures"
    },
    {
      "value": "orthopedic",
      "label": "Orthopedic Surgery",
      "description": "Musculoskeletal surgical procedures"
    },
    {
      "value": "cardiovascular",
      "label": "Cardiovascular Surgery",
      "description": "Heart and vascular surgical procedures"
    },
    {
      "value": "neurological",
      "label": "Neurological Surgery",
      "description": "Brain and nervous system surgical procedures"
    },
    {
      "value": "other_surgical",
      "label": "Other Surgical Specialty",
      "description": "Other surgical subspecialty not listed above"
    }
  ],
  "show_when": {
    "question_id": "surgical_practice",
    "equals": "true"
  },
  "cans_field": "provider.subspecialty"
}
```

Key constraints:
- `provider.subspecialty` is in the CANS field allowlist (already validated)
- No `action_assignments` on this question -- scope actions are already granted by `surgical_practice`
- The question only appears for surgical physicians (the required branching behavior)
- The `show_when.question_id` points to `surgical_practice` which appears earlier in the array (passes forward-reference validation in loader Step 4)

After adding, verify the total question count is now 13 (was 12). The question order in the array must be: `surgical_practice` (index 8), `surgical_subspecialty` (index 9), `patient_education` (index 10), `care_coordination` (index 11), `billing` (index 12).
  </action>
  <verify>
Run `pnpm test` -- all tests must pass. The existing test "has at least one question with show_when" will now find 3 conditional questions (was 2: supervision_role, controlled_substances; now adds surgical_subspecialty). The show_when ordering test will verify surgical_subspecialty's reference to surgical_practice is valid. Schema validation, taxonomy cross-validation, and CANS field validation will all run through the loader's 4-step pipeline.
  </verify>
  <done>
physician.json has 13 questions. The `surgical_subspecialty` question has `show_when: { question_id: "surgical_practice", equals: "true" }`. Both branching axes required by QUES-02 are present: (1) academic/private via supervision_role branching from practice_setting, and (2) surgical/non-surgical via surgical_subspecialty branching from surgical_practice. All tests pass with no regressions.
  </done>
</task>

</tasks>

<verification>
1. `pnpm test` passes -- all 77+ tests green, coverage >80%
2. `physician.json` contains exactly 3 questions with `show_when` conditions:
   - `supervision_role` -> branches from `practice_setting` (academic/private axis)
   - `controlled_substances` -> branches from `prescribing`
   - `surgical_subspecialty` -> branches from `surgical_practice` (surgical/non-surgical axis)
3. The loader's 4-step validation pipeline accepts the updated physician.json without errors
4. No code changes were needed -- data-only fix
</verification>

<success_criteria>
- physician.json has a question with show_when referencing surgical_practice
- Both QUES-02 branching axes are covered (academic/private AND surgical/non-surgical)
- All existing tests pass without modification
- pnpm build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/02-questionnaire-repository/02-03-SUMMARY.md`
</output>
