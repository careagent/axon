# Phase 5.1: Mock Server HTTP Route Completeness - Context

**Gathered:** 2026-02-22
**Status:** Ready for planning

<domain>
## Phase Boundary

Add missing taxonomy, questionnaire, and registry HTTP routes to the existing mock Axon server. Fix the search path mismatch (`/v1/search` → `/v1/registry/search`). After this phase, consumers can integration-test all documented operations entirely over HTTP without class imports.

</domain>

<decisions>
## Implementation Decisions

### Response shape & contracts
- Claude's discretion on envelope wrapping vs direct payload — should stay consistent with the existing mock server patterns (currently: direct objects for success, `{ results: [...] }` for search, `{ error: "message" }` for errors)
- Claude's discretion on error format — should match what neuron's `AxonClient` already parses (status-code-driven with `{ error: string }` body)
- All list endpoints get `limit`/`offset` pagination — the registry layer already supports this via `RegistrySearchQuerySchema` but it's not yet exposed over HTTP; new routes should expose it
- Claude's discretion on pagination style — offset-based is already implemented in the registry module, should stay consistent

### Search path migration
- Hard swap: move search from `/v1/search` to `/v1/registry/search`, update all tests — old path stops working immediately
- All registry routes grouped under `/v1/registry` prefix: `/v1/registry/search`, `/v1/registry/:npi`
- All routes use consistent module prefixes: `/v1/taxonomy/...`, `/v1/questionnaires/...`, `/v1/registry/...`
- Claude's discretion on whether `/v1` prefix should be configurable or hardcoded

### Route behavior on edge cases
- Claude's discretion on unknown provider types, invalid NPIs, empty results — follow standard API conventions and stay consistent with existing mock server error handling patterns
- Claude's discretion on NPI format validation at the HTTP layer — existing `AxonRegistry` already has Luhn validation, should reuse that
- Claude's discretion on configurable failure scenarios — existing mock server already has `failureMode` option, new routes should follow the same pattern
- Claude's discretion on content-type enforcement — match existing mock server behavior (currently no enforcement)

### Fixture & seed data
- Taxonomy route returns real data via `AxonTaxonomy` module — not simplified fixtures, keeps data in sync automatically
- Questionnaire route returns real data via `AxonQuestionnaires` module — not fixtures, stays in sync with actual questionnaire definitions
- Claude's discretion on registry seed data — existing mock already pre-seeds 1 org + 3 providers via `fixtures.ts`, new registry routes should work with the same fixtures
- Claude's discretion on reset endpoint — existing tests use `createMockAxonServer()` factory with `start()`/`stop()` lifecycle per test suite, follow that pattern

### Claude's Discretion
- Envelope vs direct payload (stay consistent with existing patterns)
- Error format details (match existing `{ error: string }` pattern)
- Pagination style (offset-based already in registry module)
- `/v1` prefix configurability
- Edge case responses for unknown types/invalid NPIs
- Failure mode support for new routes
- Content-type enforcement
- Registry seed data (use existing fixtures)
- Reset mechanism (follow existing lifecycle pattern)

</decisions>

<specifics>
## Specific Ideas

- Neuron's `AxonClient` is status-code-driven — it checks `res.ok` and throws `AxonError` with the status code on failure. Error body parsing is secondary. New routes must return correct HTTP status codes above all else.
- The registry module already implements offset-based pagination (`limit` default 20, max 100, `offset` default 0) but the current `/v1/search` endpoint doesn't pass these through. The fix should surface `limit` and `offset` query params on the search route.
- Existing mock server uses Node.js built-in `http` module — no framework. New routes should follow the same raw `req`/`res` pattern.
- Neuron currently has its own duplicate mock server at `neuron/test/mock-axon/` — the routes added here in Axon's mock should be the canonical implementation that neuron can eventually consume instead.

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 05.1-mock-server-http-route-completeness*
*Context gathered: 2026-02-22*
